#!/bin/sh
. "$(dirname "$0")/_/husky.sh"

echo "ğŸ” Pre-commit validation (fast mode)..."

# Auto-fix code formatting BEFORE testing (zero friction)
echo "ğŸ”§ Auto-formatting code..."
dotnet format Darklands.sln --verbosity minimal
if [ $? -eq 0 ]; then
    # Stage any formatting changes automatically
    git add -u 2>/dev/null
    echo "âœ… Code formatted automatically"
else
    echo "âš ï¸  Could not auto-format (continuing anyway)"
fi

# FAST MODE: Only run quick architecture tests (<2 seconds)
echo "âš¡ Running quick architecture tests..."
dotnet test tests/Darklands.Core.Tests.csproj --no-build --verbosity minimal --filter "Category=Architecture" 2>/dev/null
if [ $? -ne 0 ]; then
    echo "âŒ Architecture tests failed."
    echo "ğŸ’¡ Tip: Run './scripts/test/quick.ps1' for details"
    echo "ğŸ’¡ To run full tests: './scripts/core/build.ps1 test'"
    exit 1
fi

echo "âœ… Pre-commit validation passed (fast mode)!"
echo "ğŸ’¡ Full tests will run on pre-push"